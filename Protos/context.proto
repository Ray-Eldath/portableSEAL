syntax = "proto3";

package portableSEAL;
option csharp_namespace = "portableSEAL.Services";

import "id.proto";
import "serialization.proto";

// @formatter:off
service Context {
    rpc Create (ContextParameters) returns (Nothing) {}
    rpc Restore (SerializedContext) returns (Nothing) {}
    rpc Export (Nothing) returns (SerializedContext) {}

    rpc Encrypt (EncryptionNecessity) returns (SerializedCiphertext) {}
    rpc Decrypt (DecryptionNecessity) returns (PlaintextData) {}

    rpc ParseCiphertext (SerializedCiphertext) returns (CiphertextId) {}

    rpc MakePlaintextInt (PlaintextData) returns (PlaintextId) {}
    rpc MakePlaintextLong (PlaintextData) returns (PlaintextId) {}

    rpc Destroy (Nothing) returns (Nothing) {}
    
    //
    
    rpc KeyGen (Nothing) returns (KeyPair) {}
}
// @formatter:on

message EncryptionNecessity {
    PlaintextId PlaintextId = 1;

    oneof PublicKey {
        KeyPairId id = 2;
        bytes bytes = 3;
    }
}

message DecryptionNecessity {
    CiphertextId CiphertextId = 1;

    oneof PrivateKey {
        KeyPairId id = 2;
        bytes bytes = 3;
    }
}

message PlaintextData {
    sint64 data = 1;
}

message ContextParameters {
    repeated uint64 CoeffModulus = 2;
    uint64 PlainModulus = 3;
    uint64 PolyModulusDegree = 4;

    bool UseDeflate = 5;
}

message KeyPair {
    KeyPairId id = 1;

    bytes PublicKey = 2;
    bytes PrivateKey = 3;
}

// @formatter:off
message Nothing {}